
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Working with Dates and Times &#8212; Cassandra Driver 3.13.0 documentation</title>
    <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '3.13.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Frequently Asked Questions" href="cqlengine/faq.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="working-with-dates-and-times">
<h1>Working with Dates and Times<a class="headerlink" href="#working-with-dates-and-times" title="Permalink to this headline">¶</a></h1>
<p>This document is meant to provide on overview of the assumptions and limitations of the driver time handling, the
reasoning behind it, and describe approaches to working with these types.</p>
<div class="section" id="timestamps-cassandra-datetype">
<h2>timestamps (Cassandra DateType)<a class="headerlink" href="#timestamps-cassandra-datetype" title="Permalink to this headline">¶</a></h2>
<p>Timestamps in Cassandra are timezone-naive timestamps encoded as millseconds since UNIX epoch. Clients working with
timestamps in this database usually find it easiest to reason about them if they are always assumed to be UTC. To quote the
pytz documentation, “The preferred way of dealing with times is to always work in UTC, converting to localtime only when
generating output to be read by humans.” The driver adheres to this tenant, and assumes UTC is always in the database. The
driver attempts to make this correct on the way in, and assumes no timezone on the way out.</p>
<div class="section" id="write-path">
<h3>Write Path<a class="headerlink" href="#write-path" title="Permalink to this headline">¶</a></h3>
<p>When inserting timestamps, the driver handles serialization for the write path as follows:</p>
<p>If the input is a <code class="docutils literal"><span class="pre">datetime.datetime</span></code>, the serialization is normalized by starting with the <code class="docutils literal"><span class="pre">utctimetuple()</span></code> of the
value.</p>
<ul class="simple">
<li>If the <code class="docutils literal"><span class="pre">datetime</span></code> object is timezone-aware, the timestamp is shifted, and represents the UTC timestamp equivalent.</li>
<li>If the <code class="docutils literal"><span class="pre">datetime</span></code> object is timezone-naive, this results in no shift – any <code class="docutils literal"><span class="pre">datetime</span></code> with no timezone information is assumed to be UTC</li>
</ul>
<p>Note the second point above applies even to “local” times created using <code class="docutils literal"><span class="pre">now()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<p>These do not contain timezone information intrinsically, so they will be assumed to be UTC and not shifted. When generating
timestamps in the application, it is clearer to use <code class="docutils literal"><span class="pre">datetime.utcnow()</span></code> to be explicit about it.</p>
<p>If the input for a timestamp is numeric, it is assumed to be a epoch-relative millisecond timestamp, as specified in the
CQL spec – no scaling or conversion is done.</p>
</div>
<div class="section" id="read-path">
<h3>Read Path<a class="headerlink" href="#read-path" title="Permalink to this headline">¶</a></h3>
<p>The driver always assumes persisted timestamps are UTC and makes no attempt to localize them. Returned values are
timezone-naive <code class="docutils literal"><span class="pre">datetime.datetime</span></code>. We follow this approach because the datetime API has deficiencies around daylight
saving time, and the defacto package for handling this is a third-party package (we try to minimize external dependencies
and not make decisions for the integrator).</p>
<p>The decision for how to handle timezones is left to the application. For the most part it is straightforward to apply
localization to the <code class="docutils literal"><span class="pre">datetime</span></code>s returned by queries. One prevalent method is to use pytz for localization:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytz</span>
<span class="n">user_tz</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s1">&#39;US/Central&#39;</span><span class="p">)</span>
<span class="n">timestamp_naive</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">ts</span>
<span class="n">timestamp_utc</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">utc</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">timestamp_naive</span><span class="p">)</span>
<span class="n">timestamp_presented</span> <span class="o">=</span> <span class="n">timestamp_utc</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">user_tz</span><span class="p">)</span>
</pre></div>
</div>
<p>This is the most robust approach (likely refactored into a function). If it is deemed too cumbersome to apply for all call
sites in the application, it is possible to patch the driver with custom deserialization for this type. However, doing
this depends depends some on internal APIs and what extensions are present, so we will only mention the possibility, and
not spell it out here.</p>
</div>
</div>
<div class="section" id="date-time-cassandra-datetype">
<h2>date, time (Cassandra DateType)<a class="headerlink" href="#date-time-cassandra-datetype" title="Permalink to this headline">¶</a></h2>
<p>Date and time in Cassandra are idealized markers, much like <code class="docutils literal"><span class="pre">datetime.date</span></code> and <code class="docutils literal"><span class="pre">datetime.time</span></code> in the Python standard
library. Unlike these Python implementations, the Cassandra encoding supports much wider ranges. To accommodate these
ranges without overflow, this driver returns these data in custom types: <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Date" title="cassandra.util.Date"><code class="xref py py-class docutils literal"><span class="pre">util.Date</span></code></a> and <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Time" title="cassandra.util.Time"><code class="xref py py-class docutils literal"><span class="pre">util.Time</span></code></a>.</p>
<div class="section" id="id1">
<h3>Write Path<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>For simple (not prepared) statements, the input values for each of these can be either a string literal or an encoded
integer. See <a class="reference external" href="https://github.com/apache/cassandra/blob/trunk/doc/cql3/CQL.textile#working-with-dates">Working with dates</a>
or <a class="reference external" href="https://github.com/apache/cassandra/blob/trunk/doc/cql3/CQL.textile#working-with-time">Working with time</a> for details
on the encoding or string formats.</p>
<p>For prepared statements, the driver accepts anything that can be used to construct the <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Date" title="cassandra.util.Date"><code class="xref py py-class docutils literal"><span class="pre">util.Date</span></code></a> or
<a class="reference internal" href="api/cassandra/util.html#cassandra.util.Time" title="cassandra.util.Time"><code class="xref py py-class docutils literal"><span class="pre">util.Time</span></code></a> classes. See the linked API docs for details.</p>
</div>
<div class="section" id="id2">
<h3>Read Path<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The driver always returns custom types for <code class="docutils literal"><span class="pre">date</span></code> and <code class="docutils literal"><span class="pre">time</span></code>.</p>
<p>The driver returns <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Date" title="cassandra.util.Date"><code class="xref py py-class docutils literal"><span class="pre">util.Date</span></code></a> for <code class="docutils literal"><span class="pre">date</span></code> in order to accommodate the wider range of values without overflow.
For applications working within the supported range of [<code class="docutils literal"><span class="pre">datetime.MINYEAR</span></code>, <code class="docutils literal"><span class="pre">datetime.MAXYEAR</span></code>], these are easily
converted to standard <code class="docutils literal"><span class="pre">datetime.date</span></code> insances using <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Date.date" title="cassandra.util.Date.date"><code class="xref py py-meth docutils literal"><span class="pre">Date.date()</span></code></a>.</p>
<p>The driver returns <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Time" title="cassandra.util.Time"><code class="xref py py-class docutils literal"><span class="pre">util.Time</span></code></a> for <code class="docutils literal"><span class="pre">time</span></code> in order to retain nanosecond precision stored in the database.
For applications not concerned with this level of precision, these are easily converted to standard <code class="docutils literal"><span class="pre">datetime.time</span></code>
insances using <a class="reference internal" href="api/cassandra/util.html#cassandra.util.Time.time" title="cassandra.util.Time.time"><code class="xref py py-meth docutils literal"><span class="pre">Time.time()</span></code></a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Cassandra Driver</a></h1>



<p class="blurb">Python driver for Cassandra</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=datastax&repo=python-driver&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrading.html">Upgrading</a></li>
<li class="toctree-l1"><a class="reference internal" href="execution_profiles.html">Execution Profiles</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="query_paging.html">Paging Large Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="lwt.html">Lightweight Transactions (Compare-and-set)</a></li>
<li class="toctree-l1"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_defined_types.html">User Defined Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_mapper.html">Object Mapper</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Working with Dates and Times</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#timestamps-cassandra-datetype">timestamps (Cassandra DateType)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#write-path">Write Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-path">Read Path</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#date-time-cassandra-datetype">date, time (Cassandra DateType)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Write Path</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Read Path</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="cqlengine/faq.html" title="previous chapter">Frequently Asked Questions</a></li>
      <li>Next: <a href="faq.html" title="next chapter">Frequently Asked Questions</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013-2017 DataStax.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/dates_and_times.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>